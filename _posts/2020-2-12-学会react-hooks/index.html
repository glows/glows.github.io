<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>React-Hooks 指南 | Glow's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="React-Hooks 指南"><meta property="og:description" content="React Hooks 含义 为函数组件提供钩子以实现外部功能，如添加状态
React 默认提供的四个最常用的钩子 useState() //状态  useEffect() //函数副作用 useContext() useReducer() 更多的 Hook包括 useReducer useCallback useMemo useRef useImperativeHandle useLayoutEffect useDebugValue 自定义Hook useImperativeHandle Typescript中搭配useImperativeHandle 和 forwardRef使用
export interface MyInputHandles { focus(): void; } const MyInput: RefForwardingComponent<MyInputHandles, MyInputProps> = ( props, ref ) => { const inputRef = useRef<HTMLInputElement>(null); useImperativeHandle(ref, () => ({ focus: () => { if (inputRef.current) { inputRef.current.focus(); } }, })); return <input {...props} ref={inputRef} />; }; export default forwardRef(MyInput); 建议useImperativeHandle和forwardRef同时使用，减少暴露给父组件的属性，避免使用 ref 这样的命令式代码 import { useRef,forwardRef,MutableRefObject,useImperativeHandle,Ref} from &ldquo;react&rdquo;;"><meta property="og:type" content="article"><meta property="og:url" content="https://glows.github.io/_posts/2020-2-12-%E5%AD%A6%E4%BC%9Areact-hooks/"><meta property="article:section" content="_posts"><meta property="article:published_time" content="2020-02-12T10:41:47+00:00"><meta property="article:modified_time" content="2020-02-12T10:41:47+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="React-Hooks 指南"><meta name=twitter:description content="React Hooks 含义 为函数组件提供钩子以实现外部功能，如添加状态
React 默认提供的四个最常用的钩子 useState() //状态  useEffect() //函数副作用 useContext() useReducer() 更多的 Hook包括 useReducer useCallback useMemo useRef useImperativeHandle useLayoutEffect useDebugValue 自定义Hook useImperativeHandle Typescript中搭配useImperativeHandle 和 forwardRef使用
export interface MyInputHandles { focus(): void; } const MyInput: RefForwardingComponent<MyInputHandles, MyInputProps> = ( props, ref ) => { const inputRef = useRef<HTMLInputElement>(null); useImperativeHandle(ref, () => ({ focus: () => { if (inputRef.current) { inputRef.current.focus(); } }, })); return <input {...props} ref={inputRef} />; }; export default forwardRef(MyInput); 建议useImperativeHandle和forwardRef同时使用，减少暴露给父组件的属性，避免使用 ref 这样的命令式代码 import { useRef,forwardRef,MutableRefObject,useImperativeHandle,Ref} from &ldquo;react&rdquo;;"><link rel=stylesheet href=https://glows.github.io/css/style-white.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://glows.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://glows.github.io><div id=logo style=background-image:url(https://glows.github.io/images/logo.png)></div><div id=title><h1>Glow's Blog</h1></div></a><div id=nav><ul><li class=icon><a href=#><i class="fas fa-bars fa-2x"></i></a></li><li><a href=/>Home</a></li><li><a href=/_posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=content itemprop=articleBody><h2 id=react-hooks-含义>React Hooks 含义</h2><p>为函数组件提供钩子以实现外部功能，如添加状态</p><h3 id=react-默认提供的四个最常用的钩子>React 默认提供的四个最常用的钩子</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JS data-lang=JS><span style=color:#a6e22e>useState</span>()  <span style=color:#75715e>//状态
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>useEffect</span>()    <span style=color:#75715e>//函数副作用
</span><span style=color:#75715e></span><span style=color:#a6e22e>useContext</span>()
<span style=color:#a6e22e>useReducer</span>()

</code></pre></div><h3 id=更多的-hook包括>更多的 Hook包括</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>useReducer</span>
<span style=color:#a6e22e>useCallback</span>
<span style=color:#a6e22e>useMemo</span>
<span style=color:#a6e22e>useRef</span>
<span style=color:#a6e22e>useImperativeHandle</span>
<span style=color:#a6e22e>useLayoutEffect</span>
<span style=color:#a6e22e>useDebugValue</span>
<span style=color:#a6e22e>自定义Hook</span>
</code></pre></div><h2 id=useimperativehandle>useImperativeHandle</h2><p>Typescript中搭配useImperativeHandle 和 forwardRef使用</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>MyInputHandles</span> {
  <span style=color:#a6e22e>focus</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span>;
}

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MyInput</span>: <span style=color:#66d9ef>RefForwardingComponent</span>&lt;<span style=color:#f92672>MyInputHandles</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>MyInputProps</span>&gt; <span style=color:#f92672>=</span> (
  <span style=color:#a6e22e>props</span>,
  <span style=color:#a6e22e>ref</span>
) <span style=color:#f92672>=&gt;</span> {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>inputRef</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRef</span>&lt;<span style=color:#f92672>HTMLInputElement</span>&gt;(<span style=color:#66d9ef>null</span>);

  <span style=color:#a6e22e>useImperativeHandle</span>(<span style=color:#a6e22e>ref</span>, () <span style=color:#f92672>=&gt;</span> ({
    <span style=color:#a6e22e>focus</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> {
      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>inputRef</span>.<span style=color:#a6e22e>current</span>) {
        <span style=color:#a6e22e>inputRef</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>focus</span>();
      }
    },
  }));

  <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>input</span> {<span style=color:#a6e22e>...props</span>} <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>inputRef</span>} /&gt;;
};

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>forwardRef</span>(<span style=color:#a6e22e>MyInput</span>);

</code></pre></div><p>建议useImperativeHandle和forwardRef同时使用，减少暴露给父组件的属性，避免使用 ref 这样的命令式代码
import { useRef,forwardRef,MutableRefObject,useImperativeHandle,Ref} from &ldquo;react&rdquo;;</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#75715e>//只暴露value、getType、focus给父级
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>InputEl</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>forwardRef</span>((<span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> {}, <span style=color:#a6e22e>ref</span>: <span style=color:#66d9ef>Ref</span>&lt;<span style=color:#f92672>any</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>JSX</span>.<span style=color:#a6e22e>Element</span><span style=color:#f92672>=&gt;</span>{
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>inputEl</span>: <span style=color:#66d9ef>MutableRefObject</span>&lt;<span style=color:#f92672>any</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRef</span>();

    <span style=color:#a6e22e>useImperativeHandle</span>(<span style=color:#a6e22e>ref</span>, ()<span style=color:#f92672>=&gt;</span>({<span style=color:#75715e>//第一个参数：暴露哪个ref；第二个参数：暴露什么
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>inputEl</span>.<span style=color:#a6e22e>current</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>HTMLInputElement</span>).<span style=color:#a6e22e>value</span>,
        <span style=color:#a6e22e>getType</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>inputEl</span>.<span style=color:#a6e22e>current</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>HTMLInputElement</span>).<span style=color:#66d9ef>type</span>,
        <span style=color:#a6e22e>focus</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>inputEl</span>.<span style=color:#a6e22e>current</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>HTMLInputElement</span>).<span style=color:#a6e22e>focus</span>()
    }));

    <span style=color:#66d9ef>return</span>(
        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>inputEl</span>} <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> {<span style=color:#a6e22e>...props</span>}/&gt;
    )
})
<span style=color:#75715e>//暴露整个input节点给父级
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>InputEl</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>forwardRef</span>((<span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> {}, <span style=color:#a6e22e>ref</span>: <span style=color:#66d9ef>Ref</span>&lt;<span style=color:#f92672>any</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>JSX</span>.<span style=color:#a6e22e>Element</span><span style=color:#f92672>=&gt;</span>{
    <span style=color:#66d9ef>return</span>(
        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>ref</span>} <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> {<span style=color:#a6e22e>...props</span>}/&gt;
    )
});

<span style=color:#75715e>//父级
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>InputWithFocusButton() {</span>
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>inputEl</span>: <span style=color:#66d9ef>MutableRefObject</span>&lt;<span style=color:#f92672>any</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRef</span>(<span style=color:#66d9ef>null</span>);

    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonClick() {</span>
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;子组件input的对象:&#39;</span>, <span style=color:#a6e22e>inputEl</span>.<span style=color:#a6e22e>current</span>);
        <span style=color:#a6e22e>inputEl</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>focus</span>();
    };
    <span style=color:#66d9ef>return</span> (
        &lt;&gt;
            &lt;<span style=color:#f92672>InputEl</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>inputEl</span>} /&gt;
            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onButtonClick</span>}&gt;<span style=color:#a6e22e>Focus</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>input</span>&lt;/<span style=color:#f92672>button</span>&gt;
        &lt;/&gt;
    );
}
</code></pre></div><p>复制代码通过forwardRef，父组件获取子组件的ref，子组件在暴露ref中，限制暴露的一些参数</p><p>*自定义hooks，封装重复使用的代码，可以抽离出成一个模块，在多个场景下使用，提高代码的复用性</p><p>参考：<br><a href=https://zh-hans.reactjs.org/blog/2020/05/22/react-hooks.html>React Hook 最佳实践</a>
<a href=https://blog.csdn.net/weixin_43902189/article/details/99689963>https://blog.csdn.net/weixin_43902189/article/details/99689963</a><br><a href=https://zh-hans.reactjs.org/docs/hooks-reference.html>React 文档</a><br><a href=https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/>useEffect完全指南</a>
<a href="https://www.bilibili.com/video/BV1VE411w7wi?p=1">video</a>
<a href=https://my.oschina.net/yj1993/blog/4327889></a><a href=https://zh-hans.reactjs.org/docs/hooks-faq.html>React Hook FAQ</a></p></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2021 glows</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/_posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>