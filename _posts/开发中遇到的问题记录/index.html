<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>开发中遇到的问题记录 | Glow's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="开发中遇到的问题记录"><meta property="og:description" content="开发中遇到的问题记录 js去重(基本数组 与 对象那个数组) var unique = {}; obarr = [ {name: 'sdsd',key: 'zc'} ] obarr.forEach(function(gpa) { unique[JSON.stringify(gpa)] = gpa }); obarr = Object.keys(unique).map(function(u) { return JSON.parse(u) });  POST application/json 适用于传递多层的json 本来以为自己写了那么多post请求，ajax已经难不住了呢， 结果现实无比的残酷， 后台换成了java，发多层级的json，后台就取不到了， 虽然到最后还是配置正确了，。。记录下来，引以为戒，
axios.post(&#34;POST&#34;, &#34;/URL&#34;, this.state.datas, {headers: {&#34;Content-Type&#34;: &#34;application/json&#34;}}) .then( res => { console.log(res.data) }) .catch(err => { console.log(err) }) // 来一个原生版的  var xhr = new XMLHttpRequest(); xhr.onreadystatechange = function () { if (xhr.readyState == 4 && xhr."><meta property="og:type" content="article"><meta property="og:url" content="https://glows.github.io/_posts/%E5%BC%80%E5%8F%91%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"><meta property="article:section" content="_posts"><meta property="article:published_time" content="2018-01-22T15:12:38+00:00"><meta property="article:modified_time" content="2018-01-22T15:12:38+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="开发中遇到的问题记录"><meta name=twitter:description content="开发中遇到的问题记录 js去重(基本数组 与 对象那个数组) var unique = {}; obarr = [ {name: 'sdsd',key: 'zc'} ] obarr.forEach(function(gpa) { unique[JSON.stringify(gpa)] = gpa }); obarr = Object.keys(unique).map(function(u) { return JSON.parse(u) });  POST application/json 适用于传递多层的json 本来以为自己写了那么多post请求，ajax已经难不住了呢， 结果现实无比的残酷， 后台换成了java，发多层级的json，后台就取不到了， 虽然到最后还是配置正确了，。。记录下来，引以为戒，
axios.post(&#34;POST&#34;, &#34;/URL&#34;, this.state.datas, {headers: {&#34;Content-Type&#34;: &#34;application/json&#34;}}) .then( res => { console.log(res.data) }) .catch(err => { console.log(err) }) // 来一个原生版的  var xhr = new XMLHttpRequest(); xhr.onreadystatechange = function () { if (xhr.readyState == 4 && xhr."><link rel=stylesheet href=https://glows.github.io/css/style-white.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://glows.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://glows.github.io><div id=logo style=background-image:url(https://glows.github.io/images/logo.png)></div><div id=title><h1>Glow's Blog</h1></div></a><div id=nav><ul><li class=icon><a href=#><i class="fas fa-bars fa-2x"></i></a></li><li><a href=/>Home</a></li><li><a href=/_posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=content itemprop=articleBody><h1 id=开发中遇到的问题记录>开发中遇到的问题记录</h1><h3 id=js去重基本数组-与-对象那个数组>js去重(基本数组 与 对象那个数组)</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>unique</span> <span style=color:#f92672>=</span> {};
    <span style=color:#a6e22e>obarr</span> <span style=color:#f92672>=</span> [
      {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;sdsd&#39;</span>,<span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;zc&#39;</span>}
    ]
    <span style=color:#a6e22e>obarr</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>gpa</span>) {
         <span style=color:#a6e22e>unique</span>[<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>gpa</span>)] <span style=color:#f92672>=</span> <span style=color:#a6e22e>gpa</span>
     });
    <span style=color:#a6e22e>obarr</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>unique</span>).<span style=color:#a6e22e>map</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>u</span>) {
         <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>u</span>)
     });
</code></pre></div><h2 id=heading></h2><p>POST application/json 适用于传递多层的json
本来以为自己写了那么多post请求，ajax已经难不住了呢，
结果现实无比的残酷，
后台换成了java，发多层级的json，后台就取不到了，
虽然到最后还是配置正确了，。。记录下来，引以为戒，</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JS data-lang=JS><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;/URL&#34;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>datas</span>, {<span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>}})
    .<span style=color:#a6e22e>then</span>( <span style=color:#a6e22e>res</span> =&gt; {  
               <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>data</span>)     
           })
    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; {
            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>)
        })

<span style=color:#75715e>// 来一个原生版的
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>xhr</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>XMLHttpRequest</span>();
    <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>onreadystatechange</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>readyState</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>200</span>) {
            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>responseText</span>);
              
            }
        }
    }
    <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>open</span>(<span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;./toLogin.do&#34;</span>, <span style=color:#66d9ef>true</span>);
    <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>setRequestHeader</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;application/json; charset=UTF-8&#34;</span>);
    <span style=color:#a6e22e>xhr</span>.<span style=color:#a6e22e>send</span>({})
</code></pre></div><p>其实重点就是请求头信息</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JS data-lang=JS><span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>
<span style=color:#75715e>// 顺便一提
</span><span style=color:#75715e></span><span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/x-www-form-urlencoded&#34;</span> <span style=color:#75715e>// 适用于大部分情况
</span><span style=color:#75715e></span><span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;multipart/form-data&#34;</span> <span style=color:#75715e>// 适用于文件上传
</span></code></pre></div><h3 id=为什么在vue的组件中data要用function返回对象呢>为什么在vue的组件中，data要用function返回对象呢？</h3><p>类比与引用数据类型。js在赋值object对象时，是直接一个相同的内存地址
如果不用function return 每个组件的data都是内存的同一个地址，那一个数据改变其他也改变了，这当然就不是我们想要的。
用function return 其实就相当于申明了新的变量，相互独立，自然就不会有这样的问题</p><p><a href=https://www.talkingcoder.com/article/6421767197575348224>[转载]</a>Vue 组件data为什么必须是函数？<br>在创建或注册模板的时候，传入一个data属性作为用来绑定的数据。但是在组件中，data必须是一个函数，而不能直接把一个对象赋值给它。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>Vue</span>.<span style=color:#a6e22e>component</span>(<span style=color:#e6db74>&#39;my-component&#39;</span>, {
  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&lt;div&gt;OK&lt;/div&gt;&#39;</span>,
  <span style=color:#a6e22e>data</span>() {
    <span style=color:#66d9ef>return</span> {} <span style=color:#75715e>// 返回一个唯一的对象，不要和其他组件共用一个对象进行返回
</span><span style=color:#75715e></span>  },
})
</code></pre></div><p>你在前面看到，在new Vue()的时候，是可以给data直接赋值为一个对象的。这是怎么回事，为什么到了组件这里就不行了。</p><p>你要理解，上面这个操作是一个简易操作，实际上，它首先需要创建一个组件构造器，然后注册组件。注册组件的本质其实就是建立一个组件构造器的引用。使用组件才是真正创建一个组件实例。所以，注册组件其实并不产生新的组件类，但会产生一个可以用来实例化的新方式。</p><p>理解这点之后，再理解js的原型链：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>MyComponent</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {}
<span style=color:#a6e22e>MyComponent</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
  <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
}
<span style=color:#75715e>// 上面是一个虚拟的组件构造器，真实的组件构造器方法很多
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>component1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>MyComponent</span>()
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>component2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>MyComponent</span>()
<span style=color:#75715e>// 上面实例化出来两个组件实例，也就是通过&lt;my-component&gt;调用，创建的两个实例
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>component1</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>component2</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>a</span> <span style=color:#75715e>// true
</span><span style=color:#75715e></span><span style=color:#a6e22e>component1</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
<span style=color:#a6e22e>component2</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>b</span> <span style=color:#75715e>// 5
</span><span style=color:#75715e></span>
</code></pre></div><p>可以看到上面代码中最后三句，这就比较坑爹了，如果两个实例同时引用一个对象，那么当你修改其中一个属性的时候，另外一个实例也会跟着改。这怎么可以，两个实例应该有自己各自的域才对。所以，需要通过下面方法来进行处理：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>MyComponent</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>()
}
<span style=color:#a6e22e>MyComponent</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
  <span style=color:#66d9ef>return</span> {
    <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
    <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
  }
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>MyComponent</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>()
}
<span style=color:#a6e22e>MyComponent</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
  <span style=color:#66d9ef>return</span> {
    <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
    <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
  }
}
<span style=color:#66d9ef>function</span> () {
  <span style=color:#66d9ef>return</span> {
    <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
    <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
  }
}
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>component1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>MyComponent</span>()
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>component2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>MyComponent</span>()
<span style=color:#66d9ef>undefined</span>
<span style=color:#a6e22e>component1</span>.<span style=color:#a6e22e>data</span><span style=color:#f92672>===</span><span style=color:#a6e22e>component2</span>.<span style=color:#a6e22e>data</span>
<span style=color:#66d9ef>false</span>
<span style=color:#a6e22e>component1</span>.<span style=color:#a6e22e>data</span>
Object {<span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>} 
</code></pre></div><p>这样每一个实例的data属性都是独立的，不会相互影响了。所以，你现在知道为什么vue组件的data必须是函数了吧。这都是因为js本身的特性带来的，跟vue本身设计无关。其实vue不应该把这个方法名取为data()，应该叫setData或其他更容易立即的方法名。</p><h2 id=axios-请求中文传输返回乱码>axios 请求中文传输返回乱码</h2><p>前后端需使用相同的编码解码方式，默认是UTF-8, axios 使用以下代码处理</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>defaults</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>put</span>[<span style=color:#e6db74>&#39;Content-Type&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;application/x-www-form-urlencoded;charset=utf-8&#39;</span>;
</code></pre></div><h2 id=axios-postput请求传递不了参数>axios, post、put请求传递不了参数?</h2><p>首先，可以试着把axios请求部分换成：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;post.php&#39;</span>, {
    <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1&#39;</span>
}).<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>response</span>) {
    <span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>);
}).<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>error</span>) {
    <span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>error</span>);
});
</code></pre></div><p>另外，由于axios默认发送数据时，数据格式是Request Payload，而并非我们常用的Form Data格式，PHP后端未必能正常获取到，所以在发送之前，需要使用qs模块对其进行处理。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>qs</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;qs&#39;</span>;
...
<span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;post.php&#39;</span>, <span style=color:#a6e22e>qs</span>.<span style=color:#a6e22e>stringify</span>({
    <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1&#39;</span>
}))
.<span style=color:#a6e22e>then</span>( ... )
.<span style=color:#66d9ef>catch</span>( ... );
</code></pre></div></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2021 glows</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/_posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>