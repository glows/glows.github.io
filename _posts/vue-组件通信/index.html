<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>vue 组件通信 | Glow's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="vue 组件通信"><meta property="og:description" content="在 Vue 中，父子组件的关系可以总结为 prop 向下传递，事件向上传递。 父组件通过 prop 给子组件下发数据，子组件通过事件给父组件发送消息。看看它们是怎么工作的。 父组件通过 prop 给子组件下发数据:
Vue.component('child', { // 在 JavaScript 中使用 camelCase props: ['myMessage'], template: '<span>{{ myMessage }}</span>' }) <!-- 在 HTML 中使用 kebab-case --> <child my-message=&#34;hello!&#34;></child> 子组件通过事件给父组件发送消息:
<div id=&#34;message-event-example&#34; class=&#34;demo&#34;> <p v-for=&#34;msg in messages&#34;>{{ msg }}</p> <button-message v-on:message=&#34;handleMessage&#34;></button-message> <!-- 使用 $on(eventName) 监听事件 --> </div> Vue.component('button-message', { template: `<div> <input type=&#34;text&#34; v-model=&#34;message&#34; /> <button v-on:click=&#34;handleSendMessage&#34;>Send</button> </div>`, data: function () { return { message: 'test message' } }, methods: { handleSendMessage: function () { this."><meta property="og:type" content="article"><meta property="og:url" content="https://glows.github.io/_posts/vue-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"><meta property="article:section" content="_posts"><meta property="article:published_time" content="2018-04-12T11:35:44+00:00"><meta property="article:modified_time" content="2018-04-12T11:35:44+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="vue 组件通信"><meta name=twitter:description content="在 Vue 中，父子组件的关系可以总结为 prop 向下传递，事件向上传递。 父组件通过 prop 给子组件下发数据，子组件通过事件给父组件发送消息。看看它们是怎么工作的。 父组件通过 prop 给子组件下发数据:
Vue.component('child', { // 在 JavaScript 中使用 camelCase props: ['myMessage'], template: '<span>{{ myMessage }}</span>' }) <!-- 在 HTML 中使用 kebab-case --> <child my-message=&#34;hello!&#34;></child> 子组件通过事件给父组件发送消息:
<div id=&#34;message-event-example&#34; class=&#34;demo&#34;> <p v-for=&#34;msg in messages&#34;>{{ msg }}</p> <button-message v-on:message=&#34;handleMessage&#34;></button-message> <!-- 使用 $on(eventName) 监听事件 --> </div> Vue.component('button-message', { template: `<div> <input type=&#34;text&#34; v-model=&#34;message&#34; /> <button v-on:click=&#34;handleSendMessage&#34;>Send</button> </div>`, data: function () { return { message: 'test message' } }, methods: { handleSendMessage: function () { this."><link rel=stylesheet href=https://glows.github.io/css/style-white.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://glows.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://glows.github.io><div id=logo style=background-image:url(https://glows.github.io/images/logo.png)></div><div id=title><h1>Glow's Blog</h1></div></a><div id=nav><ul><li class=icon><a href=#><i class="fas fa-bars fa-2x"></i></a></li><li><a href=/>Home</a></li><li><a href=/_posts/>Writings</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about>About</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=content itemprop=articleBody><p>在 Vue 中，父子组件的关系可以总结为 prop 向下传递，事件向上传递。
父组件通过 prop 给子组件下发数据，子组件通过事件给父组件发送消息。看看它们是怎么工作的。
<img src=../images/props-events.png alt=图片来自vuejs.org></p><p>父组件通过 prop 给子组件下发数据:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Vue</span>.<span style=color:#a6e22e>component</span>(<span style=color:#e6db74>&#39;child&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 在 JavaScript 中使用 camelCase
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;myMessage&#39;</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&lt;span&gt;{{ myMessage }}&lt;/span&gt;&#39;</span>
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- 在 HTML 中使用 kebab-case --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>child</span> <span style=color:#a6e22e>my-message</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hello!&#34;</span>&gt;&lt;/<span style=color:#f92672>child</span>&gt;
</span></span></code></pre></div><p>子组件通过事件给父组件发送消息:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;message-event-example&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;demo&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>p</span> <span style=color:#a6e22e>v-for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msg in messages&#34;</span>&gt;{{ msg }}&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>button-message</span> <span style=color:#a6e22e>v-on:message</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;handleMessage&#34;</span>&gt;&lt;/<span style=color:#f92672>button-message</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#75715e>&lt;!-- 使用 $on(eventName) 监听事件 --&gt;</span>
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Vue</span>.<span style=color:#a6e22e>component</span>(<span style=color:#e6db74>&#39;button-message&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;input type=&#34;text&#34; v-model=&#34;message&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;button v-on:click=&#34;handleSendMessage&#34;&gt;Send&lt;/button&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;/div&gt;`</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;test message&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>methods</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>handleSendMessage</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$emit</span>(<span style=color:#e6db74>&#39;message&#39;</span>, { <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span> })   <span style=color:#75715e>// 使用 $emit(eventName, optionalPayload) 触发事件 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Vue</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>el</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#message-event-example&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>messages</span><span style=color:#f92672>:</span> []
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>methods</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>payload</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>messages</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>payload</span>.<span style=color:#a6e22e>message</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><h2 id=非父子组件通信>非父子组件通信</h2><p>有时候两个组件也需要通信（非父子关系）。在简单的场景下可是使用一个空的vue实例作为中央事件总线：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>bus</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Vue</span>()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>//触发组件 A 中的事件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>bus</span>.<span style=color:#a6e22e>$emit</span>(<span style=color:#e6db74>&#39;is-selected&#39;</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#e6db74>``````</span><span style=color:#a6e22e>js</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//在组件 B 创建的钩子中监听事件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>bus</span>.<span style=color:#a6e22e>$on</span>(<span style=color:#e6db74>&#39;is-selected&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>id</span>){
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>这个集中式的事件中间件就是 Bus。可以将bus定义到全局：
app.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>eventBus</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>install</span>(<span style=color:#a6e22e>Vue</span>,<span style=color:#a6e22e>options</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Vue</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>$bus</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vue</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#a6e22e>Vue</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>eventBus</span>);
</span></span></code></pre></div><p>然后在组件中，可以使用$emit， $on， $off 分别来分发、监听、取消监听事件：
分发事件的组件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>methods</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>todo</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$bus</span>.<span style=color:#a6e22e>$emit</span>(<span style=color:#e6db74>&#39;todoSth&#39;</span>, <span style=color:#a6e22e>params</span>);  <span style=color:#75715e>//params是传递的参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>监听的组件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>created</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$bus</span>.<span style=color:#a6e22e>$on</span>(<span style=color:#e6db74>&#39;todoSth&#39;</span>, (<span style=color:#a6e22e>params</span>) =&gt; {  <span style=color:#75715e>//获取传递的参数并进行操作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>//todo something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  })
</span></span><span style=display:flex><span>},
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 最好在组件销毁前
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 清除事件监听
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>beforeDestroy</span> () {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$bus</span>.<span style=color:#a6e22e>$off</span>(<span style=color:#e6db74>&#39;todoSth&#39;</span>);
</span></span><span style=display:flex><span>},
</span></span></code></pre></div><p>如果需要监听多个组件，只需要更改 bus 的 eventName:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>created</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$bus</span>.<span style=color:#a6e22e>$on</span>(<span style=color:#e6db74>&#39;firstTodo&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>firstTodo</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$bus</span>.<span style=color:#a6e22e>$on</span>(<span style=color:#e6db74>&#39;secondTodo&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>secondTodo</span>);
</span></span><span style=display:flex><span>},
</span></span><span style=display:flex><span><span style=color:#75715e>// 清除事件监听
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>beforeDestroy</span> () {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$bus</span>.<span style=color:#a6e22e>$off</span>(<span style=color:#e6db74>&#39;firstTodo&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>firstTodo</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>$bus</span>.<span style=color:#a6e22e>$off</span>(<span style=color:#e6db74>&#39;secondTodo&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>secondTodo</span>);
</span></span><span style=display:flex><span>},
</span></span></code></pre></div></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2022 glows</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/_posts/>Writings</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script></html>